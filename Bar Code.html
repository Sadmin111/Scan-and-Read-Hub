<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Modern Barcode Generator</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

<style>
    body {
        font-family: 'Inter', sans-serif;
        background: #f2f4f7;
        margin: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
        overflow: hidden;
        position: relative;
    }

    .barcode-floating-bg {
        position: absolute;
        top: 0; left: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
        z-index: 0;
        pointer-events: none;
    }

    .float-barcode {
        position: absolute;
        opacity: 0.15;
        animation: floatUp linear infinite;
        filter: blur(2px);
    }

    @keyframes floatUp {
        0% { transform: translateY(100vh) rotate(0deg); }
        100% { transform: translateY(-120vh) rotate(4deg); }
    }

    .container {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 360px;
        background: #ffffff;
        padding: 60px;
        border-radius: 20px;
        box-shadow: 0 8px 20px rgba(0,0,0,0.08);
        text-align: center;
        animation: fadeIn 0.6s ease;
        z-index: 10;
        position: relative;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .title {
        font-size: 22px;
        font-weight: 600;
        margin-bottom: 16px;
        color: #1a1a1a;
    }

    input {
        display: block;
        margin: 0 auto;
        width: 100%;
        padding: 12px;
        border-radius: 16px;
        border: 2px solid #d0d5dd;
        font-size: 15px;
        outline: none;
        transition: 0.2s;
    }

    input:focus {
        border-color: #6366f1;
        box-shadow: 0 0 0 4px rgba(99,102,241,0.15);
    }

    input.error {
        border-color: #ef4444;
        box-shadow: 0 0 0 4px rgba(248,113,113,0.35);
    }

    button {
        width: 100%;
        margin-top: 15px;
        padding: 14px;
        border: none;
        border-radius: 12px;
        background: #6366f1;
        color: #fff;
        font-size: 16px;
        cursor: pointer;
        font-weight: 600;
        transition: 0.25s;
    }

    button:hover {
        background: #4f46e5;
    }

    #barcodeContainer {
        margin-top: 25px;
        display: none;
        padding: 12px 16px;
        border-radius: 16px;
        border: 1px dashed #d0d5dd;
        background: #f9fafb;
    }

    #barcode {
        width: 260px;
        max-width: 100%;
    }

    .download-btn {
        margin-top: 12px;
        background: #10b981;
    }

    .download-btn:hover {
        background: #059669;
    }

    .hint {
        margin-top: 8px;
        font-size: 12px;
        color: #6b7280;
    }
</style>
</head>

<body>

<div class="barcode-floating-bg" id="bgBarcodeContainer"></div>

<div class="container">
    <div class="title">Barcode Generator</div>

    <input type="text" id="barcodeInput" placeholder="Enter text / number for barcode...">

    <button id="generateBtn" onclick="generateBarcode()">Generate Barcode</button>

    <div id="barcodeContainer">
        <svg id="barcode"></svg>
        <div class="hint">CODE128 format Â· Best with letters & numbers</div>
    </div>

    <button class="download-btn" id="downloadBtn" style="display:none;" onclick="downloadBarcode()">
        Download Barcode
    </button>
</div>

<!-- Make sure this actually loads (check DevTools > Network) -->
<script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>

<script>
    let animationStarted = false;

    function startBackgroundAnimation() {
        if (animationStarted) return;
        animationStarted = true;

        const container = document.getElementById("bgBarcodeContainer");
        container.innerHTML = "";

        const dummyValues = ["ITEM01", "SCANME", "123456", "BARCODE", "DUMMY1", "987654", "LABEL", "PRODUCT", "STOCK", "CODE128"];

        for (let i = 0; i < 10; i++) {
            const img = document.createElement("img");
            const text = encodeURIComponent(dummyValues[i % dummyValues.length]);
            img.src =
                "https://bwipjs-api.metafloor.com/?bcid=code128&text=" +
                text +
                "&scale=2&includetext&background=ffffff";

            img.className = "float-barcode";

            const width = Math.random() * 60 + 80;
            const left = Math.random() * 100;
            const duration = Math.random() * 10 + 15;
            const delay = Math.random() * 5;

            img.style.width = width + "px";
            img.style.left = left + "vw";
            img.style.animationDuration = duration + "s";
            img.style.animationDelay = delay + "s";

            container.appendChild(img);
        }
    }

    function generateBarcode() {
        const input = document.getElementById("barcodeInput");
        const value = input.value.trim();

        if (value === "") {
            input.classList.add("error");
            setTimeout(() => input.classList.remove("error"), 500);
            return;
        }

        if (typeof JsBarcode === "undefined") {
            alert("JsBarcode library not loaded. Check your internet / CDN blocking.");
            console.error("JsBarcode is undefined. CDN may be blocked.");
            return;
        }

        startBackgroundAnimation();

        const svg = document.getElementById("barcode");

        try {
            JsBarcode(svg, value, {
                format: "CODE128",
                lineColor: "#111827",
                width: 2,
                height: 80,
                displayValue: true,
                font: "Inter",
                fontSize: 14,
                margin: 10
            });

            document.getElementById("barcodeContainer").style.display = "block";
            document.getElementById("downloadBtn").style.display = "block";
            console.log("Barcode generated for:", value);
        } catch (e) {
            console.error("Barcode generation error:", e);
            input.classList.add("error");
            alert("Could not generate barcode for this value.");
            setTimeout(() => input.classList.remove("error"), 800);
        }
    }

    function downloadBarcode() {
        const svg = document.getElementById("barcode");
        const serializer = new XMLSerializer();
        const svgString = serializer.serializeToString(svg);

        const canvas = document.createElement("canvas");
        const ctx = canvas.getContext("2d");

        const img = new Image();
        img.onload = function () {
            canvas.width = img.width * 2;
            canvas.height = img.height * 2;
            ctx.setTransform(2, 0, 0, 2, 0, 0);
            ctx.drawImage(img, 0, 0);

            const pngData = canvas.toDataURL("image/png");
            const link = document.createElement("a");
            link.href = pngData;
            link.download = "barcode.png";
            link.click();
        };

        const svgBase64 = btoa(unescape(encodeURIComponent(svgString)));
        img.src = "data:image/svg+xml;base64," + svgBase64;
    }

    // Press Enter to generate
    document.getElementById("barcodeInput").addEventListener("keydown", function (e) {
        if (e.key === "Enter") {
            e.preventDefault();
            generateBarcode();
        }
    });
</script>

</body>
</html>
